#cloud-config

hostname: controller
manage_etc_hosts: true

users:
  - name: bltavares
    shell: /bin/bash
    sudo: ALL=(ALL) NOPASSWD:ALL
    groups: users,docker,netdev,video
    lock_passwd: true
    ssh-authorized-keys:
      - ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQC5027ecdYFEWCaO45DuB2681dIYS7ThssorL61x9FZPp7TL1Ul+g84kGlHSRjs7btPpqilhq4G8cC8qLE28uNNTdRMGvxWqWYJvpXIYUeiGlNS+Tm8XsUxJ6XAlAdXmLXH5Mu2T2Glqh7vugpOGEiDZTmxHGcsU2SlcQthRQNrDKhMl5k9IgNsJxxbGM1PzFlCumF3HTM/RK0hYKdwdnj4THqMb7iTRQdVuFobVrqz/U8Gdv6CAHdieU/3YmLr+Pphrm8rWXjQMr3Yn22jzMq0FXreM1e76emN+UHfwf3MmSVVTeaEndbBpVXV1LANNXlYAv9QNiR0kXyBhGFhRvaz bltav@Vaporware

package_update: true
package_upgrade: true
package_reboot_if_required: true

packages:
 - ntp
 - libnss-mdns
 # Not needed on Hypriot v10
 - ssh-import-id
 # Controller
 - bridge-utils
 - wiringpi
 - python-rpi.gpio
 - minicom

locale: "en_US.UTF-8"
timezone: "UTC"

# These commands will be ran once on first boot only
runcmd:
  - 'systemctl enable github-keys@bltavares.timer'
  # Controller
  ## Configures network after initial setup
  - 'mv /etc/network/interfaces.controller /etc/network/interfaces'
  - 'cat /etc/dhcpcd.conf.controller >> /etc/dhcpcd.conf'
  - 'systemctl enable clusterhat.timer'
  - 'reboot'
  
write_files:
  - content: |
      [Unit]
      Description=Import keys on boot and keep updated
      [Timer]
      OnBootSec=1min
      OnUnitActiveSec=1d 
      [Install]
      WantedBy=timers.target
    path: /etc/systemd/system/github-keys@.timer

  - content: |
      [Unit]
      Description=Import keys for %i
      Wants=network-online.target
      After=network-online.target
      [Service]
      Type=oneshot
      ExecStart=/usr/bin/ssh-import-id gh:%i
      User=%i
    path: /etc/systemd/system/github-keys@.service

  # Controller
  - content: |
      [Unit]
      Description=Turn on clusterhat
      [Timer]
      OnBootSec=1min
      [Install]
      WantedBy=timers.target
    path: /etc/systemd/system/clusterhat.timer

  - content: |
      [Unit]
      Description=Turn on clusterhat
      Wants=network-online.target
      After=network-online.target
      [Service]
      Type=oneshot
      ExecStartPre=/sbin/iptables -P FORWARD ACCEPT
      ExecStart=/sbin/clusterhat on
    path: /etc/systemd/system/clusterhat.service

  ## Content to show on login console
  - content: |
      HypriotOS (Debian GNU/Linux 9) \n \l
      br0 - IPv4: \4{br0} IPv6: \6{br0}
      eth0 - IPv4: \4{eth0} IPv6: \6{eth0}
    path: /etc/issue
    
  - content: IyBDbHVzdGVySEFUIFBpIFplcm8gRXRoZXJuZXQgRGV2aWNlcwpTVUJTWVNURU09PSJuZXQiLCBBVFRSe2FkZHJlc3N9PT0iMDA6MjI6ODI6ZmY6ZmU6MDEiLCBOQU1FPSJldGhwaTEiClNVQlNZU1RFTT09Im5ldCIsIEFUVFJ7YWRkcmVzc309PSIwMDoyMjo4MjpmZjpmZTowMiIsIE5BTUU9ImV0aHBpMiIKU1VCU1lTVEVNPT0ibmV0IiwgQVRUUnthZGRyZXNzfT09IjAwOjIyOjgyOmZmOmZlOjAzIiwgTkFNRT0iZXRocGkzIgpTVUJTWVNURU09PSJuZXQiLCBBVFRSe2FkZHJlc3N9PT0iMDA6MjI6ODI6ZmY6ZmU6MDQiLCBOQU1FPSJldGhwaTQiCgojIENsdXN0ZXJIQVQgUGkgWmVybyBTZXJpYWwgUG9ydHMgKHRvcCBsZWZ0IFVTQiBwb3J0IG9uIFBpMyspClNVQlNZU1RFTT09InR0eSIsIEtFUk5FTFM9PSIxLTEuMS4yLjEiLCBBVFRSU3tpZFByb2R1Y3R9PT0iYTRhYSIsIEFUVFJTe2lkVmVuZG9yfT09IjA1MjUiLCBTWU1MSU5LKz0idHR5cGk0IgpTVUJTWVNURU09PSJ0dHkiLCBLRVJORUxTPT0iMS0xLjEuMi4yIiwgQVRUUlN7aWRQcm9kdWN0fT09ImE0YWEiLCBBVFRSU3tpZFZlbmRvcn09PSIwNTI1IiwgU1lNTElOSys9InR0eXBpMyIKU1VCU1lTVEVNPT0idHR5IiwgS0VSTkVMUz09IjEtMS4xLjIuMyIsIEFUVFJTe2lkUHJvZHVjdH09PSJhNGFhIiwgQVRUUlN7aWRWZW5kb3J9PT0iMDUyNSIsIFNZTUxJTksrPSJ0dHlwaTIiClNVQlNZU1RFTT09InR0eSIsIEtFUk5FTFM9PSIxLTEuMS4yLjQiLCBBVFRSU3tpZFByb2R1Y3R9PT0iYTRhYSIsIEFUVFJTe2lkVmVuZG9yfT09IjA1MjUiLCBTWU1MSU5LKz0idHR5cGkxIgojIENsdXN0ZXJIQVQgUGkgWmVybyBTZXJpYWwgUG9ydHMgKGJvdHRvbSBsZWZ0IFVTQiBwb3J0IG9uIFBpMyspClNVQlNZU1RFTT09InR0eSIsIEtFUk5FTFM9PSIxLTEuMS4zLjEiLCBBVFRSU3tpZFByb2R1Y3R9PT0iYTRhYSIsIEFUVFJTe2lkVmVuZG9yfT09IjA1MjUiLCBTWU1MSU5LKz0idHR5cGk0IgpTVUJTWVNURU09PSJ0dHkiLCBLRVJORUxTPT0iMS0xLjEuMy4yIiwgQVRUUlN7aWRQcm9kdWN0fT09ImE0YWEiLCBBVFRSU3tpZFZlbmRvcn09PSIwNTI1IiwgU1lNTElOSys9InR0eXBpMyIKU1VCU1lTVEVNPT0idHR5IiwgS0VSTkVMUz09IjEtMS4xLjMuMyIsIEFUVFJTe2lkUHJvZHVjdH09PSJhNGFhIiwgQVRUUlN7aWRWZW5kb3J9PT0iMDUyNSIsIFNZTUxJTksrPSJ0dHlwaTIiClNVQlNZU1RFTT09InR0eSIsIEtFUk5FTFM9PSIxLTEuMS4zLjQiLCBBVFRSU3tpZFByb2R1Y3R9PT0iYTRhYSIsIEFUVFJTe2lkVmVuZG9yfT09IjA1MjUiLCBTWU1MSU5LKz0idHR5cGkxIgojIENsdXN0ZXJIQVQgUGkgWmVybyBTZXJpYWwgUG9ydHMgKHRvcCByaWdodCBVU0IgcG9ydCBvbiBQaTMrKQpTVUJTWVNURU09PSJ0dHkiLCBLRVJORUxTPT0iMS0xLjMuMSIsIEFUVFJTe2lkUHJvZHVjdH09PSJhNGFhIiwgQVRUUlN7aWRWZW5kb3J9PT0iMDUyNSIsIFNZTUxJTksrPSJ0dHlwaTQiClNVQlNZU1RFTT09InR0eSIsIEtFUk5FTFM9PSIxLTEuMy4yIiwgQVRUUlN7aWRQcm9kdWN0fT09ImE0YWEiLCBBVFRSU3tpZFZlbmRvcn09PSIwNTI1IiwgU1lNTElOSys9InR0eXBpMyIKU1VCU1lTVEVNPT0idHR5IiwgS0VSTkVMUz09IjEtMS4zLjMiLCBBVFRSU3tpZFByb2R1Y3R9PT0iYTRhYSIsIEFUVFJTe2lkVmVuZG9yfT09IjA1MjUiLCBTWU1MSU5LKz0idHR5cGkyIgpTVUJTWVNURU09PSJ0dHkiLCBLRVJORUxTPT0iMS0xLjMuNCIsIEFUVFJTe2lkUHJvZHVjdH09PSJhNGFhIiwgQVRUUlN7aWRWZW5kb3J9PT0iMDUyNSIsIFNZTUxJTksrPSJ0dHlwaTEiCiMgQ2x1c3RlckhBVCBQaSBaZXJvIFNlcmlhbCBQb3J0cyAoYm90dG9tIHJpZ2h0IFVTQiBwb3J0IG9uIFBpMyspClNVQlNZU1RFTT09InR0eSIsIEtFUk5FTFM9PSIxLTEuMi4xIiwgQVRUUlN7aWRQcm9kdWN0fT09ImE0YWEiLCBBVFRSU3tpZFZlbmRvcn09PSIwNTI1IiwgU1lNTElOSys9InR0eXBpNCIKU1VCU1lTVEVNPT0idHR5IiwgS0VSTkVMUz09IjEtMS4yLjIiLCBBVFRSU3tpZFByb2R1Y3R9PT0iYTRhYSIsIEFUVFJTe2lkVmVuZG9yfT09IjA1MjUiLCBTWU1MSU5LKz0idHR5cGkzIgpTVUJTWVNURU09PSJ0dHkiLCBLRVJORUxTPT0iMS0xLjIuMyIsIEFUVFJTe2lkUHJvZHVjdH09PSJhNGFhIiwgQVRUUlN7aWRWZW5kb3J9PT0iMDUyNSIsIFNZTUxJTksrPSJ0dHlwaTIiClNVQlNZU1RFTT09InR0eSIsIEtFUk5FTFM9PSIxLTEuMi40IiwgQVRUUlN7aWRQcm9kdWN0fT09ImE0YWEiLCBBVFRSU3tpZFZlbmRvcn09PSIwNTI1IiwgU1lNTElOSys9InR0eXBpMSIKIyBDbHVzdGVySEFUIFBpIFplcm8gU2VyaWFsIFBvcnRzICh0b3AgbGVmdCBVU0IgcG9ydCBvbiBCKy8yLzMpClNVQlNZU1RFTT09InR0eSIsIEtFUk5FTFM9PSIxLTEuMi4xIiwgQVRUUlN7aWRQcm9kdWN0fT09ImE0YWEiLCBBVFRSU3tpZFZlbmRvcn09PSIwNTI1IiwgU1lNTElOSys9InR0eXBpNCIKU1VCU1lTVEVNPT0idHR5IiwgS0VSTkVMUz09IjEtMS4yLjIiLCBBVFRSU3tpZFByb2R1Y3R9PT0iYTRhYSIsIEFUVFJTe2lkVmVuZG9yfT09IjA1MjUiLCBTWU1MSU5LKz0idHR5cGkzIgpTVUJTWVNURU09PSJ0dHkiLCBLRVJORUxTPT0iMS0xLjIuMyIsIEFUVFJTe2lkUHJvZHVjdH09PSJhNGFhIiwgQVRUUlN7aWRWZW5kb3J9PT0iMDUyNSIsIFNZTUxJTksrPSJ0dHlwaTIiClNVQlNZU1RFTT09InR0eSIsIEtFUk5FTFM9PSIxLTEuMi40IiwgQVRUUlN7aWRQcm9kdWN0fT09ImE0YWEiLCBBVFRSU3tpZFZlbmRvcn09PSIwNTI1IiwgU1lNTElOSys9InR0eXBpMSIKIyBDbHVzdGVySEFUIFBpIFplcm8gU2VyaWFsIFBvcnRzIChib3R0b20gbGVmdCBVU0IgcG9ydCBvbiBCKy8yLzMpClNVQlNZU1RFTT09InR0eSIsIEtFUk5FTFM9PSIxLTEuMy4xIiwgQVRUUlN7aWRQcm9kdWN0fT09ImE0YWEiLCBBVFRSU3tpZFZlbmRvcn09PSIwNTI1IiwgU1lNTElOSys9InR0eXBpNCIKU1VCU1lTVEVNPT0idHR5IiwgS0VSTkVMUz09IjEtMS4zLjIiLCBBVFRSU3tpZFByb2R1Y3R9PT0iYTRhYSIsIEFUVFJTe2lkVmVuZG9yfT09IjA1MjUiLCBTWU1MSU5LKz0idHR5cGkzIgpTVUJTWVNURU09PSJ0dHkiLCBLRVJORUxTPT0iMS0xLjMuMyIsIEFUVFJTe2lkUHJvZHVjdH09PSJhNGFhIiwgQVRUUlN7aWRWZW5kb3J9PT0iMDUyNSIsIFNZTUxJTksrPSJ0dHlwaTIiClNVQlNZU1RFTT09InR0eSIsIEtFUk5FTFM9PSIxLTEuMy40IiwgQVRUUlN7aWRQcm9kdWN0fT09ImE0YWEiLCBBVFRSU3tpZFZlbmRvcn09PSIwNTI1IiwgU1lNTElOSys9InR0eXBpMSIKIyBDbHVzZXJIQVQgUGkgWmVybyBTZXJpYWwgUG9ydHMgKHRvcCByaWdodCBVU0IgcG9ydCBvbiBCKy8yLzMpClNVQlNZU1RFTT09InR0eSIsIEtFUk5FTFM9PSIxLTEuNC4xIiwgQVRUUlN7aWRQcm9kdWN0fT09ImE0YWEiLCBBVFRSU3tpZFZlbmRvcn09PSIwNTI1IiwgU1lNTElOSys9InR0eXBpNCIKU1VCU1lTVEVNPT0idHR5IiwgS0VSTkVMUz09IjEtMS40LjIiLCBBVFRSU3tpZFByb2R1Y3R9PT0iYTRhYSIsIEFUVFJTe2lkVmVuZG9yfT09IjA1MjUiLCBTWU1MSU5LKz0idHR5cGkzIgpTVUJTWVNURU09PSJ0dHkiLCBLRVJORUxTPT0iMS0xLjQuMyIsIEFUVFJTe2lkUHJvZHVjdH09PSJhNGFhIiwgQVRUUlN7aWRWZW5kb3J9PT0iMDUyNSIsIFNZTUxJTksrPSJ0dHlwaTIiClNVQlNZU1RFTT09InR0eSIsIEtFUk5FTFM9PSIxLTEuNC40IiwgQVRUUlN7aWRQcm9kdWN0fT09ImE0YWEiLCBBVFRSU3tpZFZlbmRvcn09PSIwNTI1IiwgU1lNTElOSys9InR0eXBpMSIKIyBDbHVzZXJIQVQgUGkgWmVybyBTZXJpYWwgUG9ydHMgKGJvdHRvbSByaWdodCBVU0IgcG9ydCBvbiBCKy8yLzMpClNVQlNZU1RFTT09InR0eSIsIEtFUk5FTFM9PSIxLTEuNS4xIiwgQVRUUlN7aWRQcm9kdWN0fT09ImE0YWEiLCBBVFRSU3tpZFZlbmRvcn09PSIwNTI1IiwgU1lNTElOSys9InR0eXBpNCIKU1VCU1lTVEVNPT0idHR5IiwgS0VSTkVMUz09IjEtMS41LjIiLCBBVFRSU3tpZFByb2R1Y3R9PT0iYTRhYSIsIEFUVFJTe2lkVmVuZG9yfT09IjA1MjUiLCBTWU1MSU5LKz0idHR5cGkzIgpTVUJTWVNURU09PSJ0dHkiLCBLRVJORUxTPT0iMS0xLjUuMyIsIEFUVFJTe2lkUHJvZHVjdH09PSJhNGFhIiwgQVRUUlN7aWRWZW5kb3J9PT0iMDUyNSIsIFNZTUxJTksrPSJ0dHlwaTIiClNVQlNZU1RFTT09InR0eSIsIEtFUk5FTFM9PSIxLTEuNS40IiwgQVRUUlN7aWRQcm9kdWN0fT09ImE0YWEiLCBBVFRSU3tpZFZlbmRvcn09PSIwNTI1IiwgU1lNTElOSys9InR0eXBpMSIKIyBDbHVzZXJIQVQgUGkgWmVybyBTZXJpYWwgUG9ydHMgKFVTQiBQb3J0IG9uIEErKQpTVUJTWVNURU09PSJ0dHkiLCBLRVJORUxTPT0iMS0xLjEiLCBBVFRSU3tpZFByb2R1Y3R9PT0iYTRhYSIsIEFUVFJTe2lkVmVuZG9yfT09IjA1MjUiLCBTWU1MSU5LKz0idHR5cGk0IgpTVUJTWVNURU09PSJ0dHkiLCBLRVJORUxTPT0iMS0xLjIiLCBBVFRSU3tpZFByb2R1Y3R9PT0iYTRhYSIsIEFUVFJTe2lkVmVuZG9yfT09IjA1MjUiLCBTWU1MSU5LKz0idHR5cGkzIgpTVUJTWVNURU09PSJ0dHkiLCBLRVJORUxTPT0iMS0xLjMiLCBBVFRSU3tpZFByb2R1Y3R9PT0iYTRhYSIsIEFUVFJTe2lkVmVuZG9yfT09IjA1MjUiLCBTWU1MSU5LKz0idHR5cGkyIgpTVUJTWVNURU09PSJ0dHkiLCBLRVJORUxTPT0iMS0xLjQiLCBBVFRSU3tpZFByb2R1Y3R9PT0iYTRhYSIsIEFUVFJTe2lkVmVuZG9yfT09IjA1MjUiLCBTWU1MSU5LKz0idHR5cGkxIgo=
    encoding: b64
    path: /etc/udev/rules.d/90-clusterhat.rules

  - content: IyEvdXNyL2Jpbi9weXRob24KIwojIENsdXN0ZXIgSEFUIGNvbnRyb2wgdG9vbAojIAojIENvbXBhdGlibGUgd2l0aCB2MS54IGFuZCB2Mi54CiMKCiMgImNsdXN0ZXJoYXQiIHRvb2wgdXNhZ2UKIwojIFN1cHBvcnRlZCBvbiB2MS54IGFuZCB2Mi54CiMKIyBUdXJuIG9uIGFsbCBQaSBaZXJvcwojICQgY2x1c3RlcmhhdCBvbgojCiMgVHVybiBvbiBpbmRpdmlkdWFsIFBpIFplcm9zCiMgJCBjbHVzdGVyaGF0IG9uIHAxIHAzCiMKIyBUdXJuIG9uL29mZiBBTEVSVCBMRUQKIyAkIGNsdXN0ZXJoYXQgYWxlcnQgb24KIyAkIGNsdXN0ZXJoYXQgYWxlcnQgb2ZmCiMKIyBHZXQgc3RhdHVzCiMgJCBjbHVzdGVyaGF0IHN0YXR1cwojCiMgU3VwcG9ydGVkIG9uIHYyLnggT05MWQojCiMgVHVybiBvbi9vZmYgVVNCIEhVQgojICQgY2x1c3RlcmhhdCBodWIgb24KIyAkIGNsdXN0ZXJoYXQgaHViIG9mZgojCiMgVHVybiBIQVQgTEVEIG9uL29mZgojICQgY2x1c3RlcmhhdCBsZWQgb24KIyAkIGNsdXN0ZXJoYXQgbGVkIG9mZgojCiMgRW5hYmxlL0Rpc2FibGUgRUVQUk9NIFdyaXRlIFByb3RlY3QKIyAkIGNsdXN0ZXJoYXQgd3Agb24KIyAkIGNsdXN0ZXJoYXQgd3Agb2ZmCiMKIyBQaHlzaWNhbCBTb2xkZXIgSnVtcGVycwojCiMgUFdSIC0gUGkgWmVybyBQb3dlciBTb3VyY2UgKDIgd2F5IHNvbGRlciBqdW1wZXIpCiMgQnkgZGVmYXVsdCBSUEk8PlVTQiBpcyBqb2luZWQsIGZvciBvdGhlciBvcHRpb25zIGJlbG93IGN1dCB0aGUgdHJhY2sKIyBSUEk8PlVTQiAtIFBpIFplcm9zIFBvd2VyZWQgdmlhIENvbnRyb2xsZXIgUGkKIyBQV1I8PlVTQiAtIFBvd2VyZWQgdmlhIFVTQgojIFBXUiAobm8gbGluaykgUG93ZXJlZCB2aWEgY29ubmVjdG9yIG9uIHVuZGVyc2lkZSBvZiBDbHVzdGVyIEhBVAojCiMgUE9TIC0gUG93ZXIgb24gc3RhdGUgKDEgd2F5IHNvbGRlciBqdW1wZXIpCiMgCiMgQnkgZGVmYXVsdCB0aGUgUE9XIGp1bXBlciBpcyBsaW5rZWQsIGN1dCB0cmFjayB0byBkaXNjb25uZWN0CiMgUE9XIFtMSU5LXSAtIEluaXRpYWwgUGkgWmVybyBzdGF0ZSBPRkYKIyBQT1cgW05PIExJTktdIC0gSW5pdGlhbCBQaSBaZXJvIHN0YXRlIE9OCiMKIyBXUCAtIEhBVCBFRVBST00gV3JpdGUgUHJvdGVjdCBbRk9SQ0VdCiMgQnkgZGVmYXVsdCBpcyBub3QgbGlua2VkCiMgV1AgW0xJTksgXSAtIEVFUFJPTSBpcyB3cml0ZSBwcm90ZWN0ZWQKIyBXUCBbTk8gTElOS10gLSBFRVBST00gd3JpdGUgcHJvdGVjdCBjYW4gYmUgZW5hYmxlZCB1c2luZyB0aGlzIHRvb2wKIwoKaW1wb3J0IHN5cywgdGltZSwgb3MsIG9zLnBhdGgKCiMgTnVtYmVyIG9mIHNlY29uZHMgdG8gd2FpdCBiZXR3ZWVuIGVuYWJsaW5nIHBvd2VyIGZvciBlYWNoIFBpIFplcm8KZGVsYXkgPSAyCgojIFZlcnNpb24gbnVtYmVyIG9mIHRoaXMgdG9vbApjbHVzdGVyaGF0X3ZlcnNpb24gPSAiMjAxODA3MDciCgojIEhBVCBGaWxlIGxvY2F0aW9ucwpoYXRfcHJvZHVjdCA9ICIvcHJvYy9kZXZpY2UtdHJlZS9oYXQvcHJvZHVjdCIKaGF0X3ZlcnNpb24gPSAiL3Byb2MvZGV2aWNlLXRyZWUvaGF0L3Byb2R1Y3RfdmVyIgpoYXRfdXVpZCAgICA9ICIvcHJvYy9kZXZpY2UtdHJlZS9oYXQvdXVpZCIKaGF0X3ZlbmRvciAgPSAiL3Byb2MvZGV2aWNlLXRyZWUvaGF0L3ZlbmRvciIKaGF0X3BpZCAgICAgPSAiL3Byb2MvZGV2aWNlLXRyZWUvaGF0L3Byb2R1Y3RfaWQiCgojIFBhdGggdG8gZXh0ZXJuYWwgY29tbWFuZHMKdmNnZW5jbWRwYXRoPSAiL3Vzci9iaW4vdmNnZW5jbWQiCgojIERvIHdlIGhhdmUgYSBIQVQ/CmlmICggbm90IG9zLnBhdGguaXNmaWxlKGhhdF9wcm9kdWN0KSAKCW9yIG5vdCBvcy5hY2Nlc3MoaGF0X3Byb2R1Y3QsIG9zLlJfT0spCglvciBub3Qgb3MucGF0aC5pc2ZpbGUoaGF0X3V1aWQpCglvciBub3Qgb3MuYWNjZXNzKGhhdF91dWlkLCBvcy5SX09LKQoJb3Igbm90IG9zLnBhdGguaXNmaWxlKGhhdF92ZW5kb3IpCglvciBub3Qgb3MuYWNjZXNzKGhhdF92ZW5kb3IsIG9zLlJfT0spCglvciBub3Qgb3MucGF0aC5pc2ZpbGUoaGF0X3BpZCkKCW9yIG5vdCBvcy5hY2Nlc3MoaGF0X3BpZCwgb3MuUl9PSykKCW9yIG5vdCBvcy5wYXRoLmlzZmlsZShoYXRfdmVyc2lvbikKCW9yIG5vdCBvcy5hY2Nlc3MoaGF0X3ZlcnNpb24sIG9zLlJfT0spICk6CglwcmludCAoICJFUlJPUjogSEFUIG5vdCBmb3VuZD8iICkKCXN5cy5leGl0KCkKCiMgSXMgaXQgYSBDbHVzdGVyIEhBVD8KZiA9IG9wZW4oaGF0X3Byb2R1Y3QsICdyJykKaWYgKCBmLnJlYWQoKS5zdHJpcCgnXHgwMCcpICE9ICdaQzQ6Q2x1c3RlckhBVCcgKToKCXByaW50ICggIkVSUk9SOiBDbHVzdGVyIEhBVCBub3QgZm91bmQ/IiApCglzeXMuZXhpdCgpCmYuY2xvc2UoKQoKIyBBcmUgd2UgcnVubmluZyBhIHYxLnggb3IgdjIueCA/CiMgMHgwMDE/ID0gdjEueCAvIDB4MDAyPyA9IHYyLngKdmVyc2lvbiA9IDAKZiA9IG9wZW4oaGF0X3ZlcnNpb24sICdyJykKdG1wID0gaW50KGYucmVhZCgpLnN0cmlwKCdceDAwJyksMTYpCmYuY2xvc2UoKQppZiAoIHRtcCA+PSAxNiBhbmQgdG1wIDw9MzEgKToKCXZlcnNpb24gPSAxCgl2ZXJzaW9uX21pbm9yID0gdG1wIC0gMTYKZWxpZiAoIHRtcCA+PSAzMiBhbmQgdG1wIDw9IDQ3ICk6Cgl2ZXJzaW9uID0gMgoJdmVyc2lvbl9taW5vciA9IHRtcCAtIDMyCmVsc2U6CglwcmludCAoICJFUlJPUjogVW5rbm93biBDbHVzdGVyIEhBVCB2ZXJzaW9uIGZvdW5kPyIgKQoJc3lzLmV4aXQoKQoKZGVmIGdldF90aHJvdHRsZWQoKToKCWlmKCBub3Qgb3MucGF0aC5pc2ZpbGUodmNnZW5jbWRwYXRoKSBvciBub3QgIG9zLmFjY2Vzcyh2Y2dlbmNtZHBhdGgsb3MuWF9PSykgKToKCQlyZXR1cm4gJ05BJwoJcmV0dXJuICggKG9zLnBvcGVuKHZjZ2VuY21kcGF0aCArICcgZ2V0X3Rocm90dGxlZCcpLnJlYWRsaW5lKCkpLnNwbGl0KCc9JywgMSlbLTFdLnN0cmlwKCkpCgojIFZlcnNpb24gc3BlY2lmaWMgc2V0dXAKaWYgKCB2ZXJzaW9uID09IDEgKToKCWltcG9ydCBSUGkuR1BJTyBhcyBHUElPCglHUElPLnNldHdhcm5pbmdzKEZhbHNlKQoJcG9ydHMgPSBbMjksIDMxLCAzMywgMzUsIDM3XQoJR1BJTy5zZXRtb2RlKEdQSU8uQk9BUkQpCglHUElPLnNldHVwKHBvcnRzLCBHUElPLk9VVCkKZWxzZTogIyB2Mi54CglzeXMucGF0aC5hcHBlbmQoJy91c3Ivc2hhcmUvY2x1c3RlcmhhdC9weXRob24nKQoJaW1wb3J0IHhyYTEyMDAsIHNtYnVzCgl3cF9saW5rID0gMAoJYnVzID0gc21idXMuU01CdXMoMSkKCWhhdCA9IHhyYTEyMDAuWHJhMTIwMChidXM9MSwgYWRkcmVzcz0weDIwKQoJcDEgPSB4cmExMjAwLlhyYTEyMDAoYnVzPTEsIGFkZHJlc3M9MHgyMCwgcG9ydD0wKQoJcDIgPSB4cmExMjAwLlhyYTEyMDAoYnVzPTEsIGFkZHJlc3M9MHgyMCwgcG9ydD0xKQoJcDMgPSB4cmExMjAwLlhyYTEyMDAoYnVzPTEsIGFkZHJlc3M9MHgyMCwgcG9ydD0yKQoJcDQgPSB4cmExMjAwLlhyYTEyMDAoYnVzPTEsIGFkZHJlc3M9MHgyMCwgcG9ydD0zKQoJbGVkID0geHJhMTIwMC5YcmExMjAwKGJ1cz0xLCBhZGRyZXNzPTB4MjAsIHBvcnQ9NCkKCWh1YiA9IHhyYTEyMDAuWHJhMTIwMChidXM9MSwgYWRkcmVzcz0weDIwLCBwb3J0PTUpCglhbGVydCA9IHhyYTEyMDAuWHJhMTIwMChidXM9MSwgYWRkcmVzcz0weDIwLCBwb3J0PTYpCgl3cCA9IHhyYTEyMDAuWHJhMTIwMChidXM9MSwgYWRkcmVzcz0weDIwLCBwb3J0PTcpCgoJIyBHZXQgc3RhdHVzIG9mIEkvTyBFeHRlbmRlciAKCWRpciA9IGhhdC5nZXRfZGlyKCkgIyBJL08gcGluIGRpcmVjdGlvbnMKCXN0YXR1cyA9IGhhdC5yZWFkX2J5dGUoKSAjIFBpbiBTdGF0dXMKCgkjIERldGVjdCBJL08gRXhwYW5kZXIKCXhyYTEyMDBwID0gVHJ1ZTsKCXB1ciA9IGhhdC5nZXRfcHVyKCkKCWlmIHB1ciA9PSAtMToKCQl4cmExMjAwcCA9IEZhbHNlCgoJIyBJZiBhbGwgcGlucyBhcmUgaW5wdXRzIHRoaXMgaXMgdGhlIGZpcnN0IHJ1biBzaW5jZSBIQVQgcG93ZXIgdXAKCWlmICggZGlyID09IDI1NSApOgoJCSMgRGV0ZWN0IGlmIFdQIGlzIGJlaW5nIHB1bGxlZCBoaWdoCgkJaWYoeHJhMTIwMHApOgoJCQloYXQuc2V0X3B1cigweDdGKSAjIERpc2FibGUgcHVsbHVwIGZvciBFRVBST00gV1Agb24gSS9PIGV4cGFuZGVyCgkJCXdwX2xpbmsgPSAoaGF0LnJlYWRfYnl0ZSgpPj43KSAjIDEgPSBzb2xkZXJlZCAvIDAgPSBvcGVuCgkJCWlmKCB3cF9saW5rID09IDEgKToKCQkJCWhhdC5zZXRfcHVyKDB4RkYpCgkJCWVsc2U6CgkJCQl3cC5vbigpCgkJZWxzZToKCQkJd3Aub24oKQoJCQl3cF9saW5rID0gLTEKCQlpZiAoICggc3RhdHVzICYgMHhGICkgPT0gMHhGICk6ICMgQ2hlY2sgUE9TIFtQb3dlciBPbiBTdGF0ZV0KCQkJIyBQT1MgW05PIExJTktdIHNldCBwb3dlciBPTiAoQ1VUKQoJCQlwMS5vbigpCgkJCXAyLm9uKCkKCQkJcDMub24oKQoJCQlwNC5vbigpCgkJZWxzZToKCQkJIyBQT1MgW0xJTktdIHNldCBwb3dlciBvZmYgKERlZmF1bHQpCgkJCXAxLm9mZigpCgkJCXAyLm9mZigpCgkJCXAzLm9mZigpCgkJCXA0Lm9mZigpCgkJIyBTZXQgZGVmYXVsdCBzdGF0ZSBmb3Igb3RoZXIgcGlucwoJCWFsZXJ0Lm9mZigpCgkJbGVkLm9uKCkKCQlpZiAoIHZlcnNpb25fbWlub3IgPT0gMCApOgoJCQlodWIub24oKQoJCWVsc2U6CgkJCWh1Yi5vZmYoKQoJCWhhdC5zZXRfZGlyKDB4MDApICMgU2V0IGFsbCBwaW5zIGFzIG91dHB1dHMKCWVsc2U6CgkJaWYodmVyc2lvbiA9PSAyIGFuZCB4cmExMjAwcD09VHJ1ZSk6CgkJCWlmIChoYXQuZ2V0X3B1cigpPj43KToKCQkJCXdwX2xpbmsgPSAxCgkJZWxzZToKCQkJd3BfbGluayA9IC0xCgphcmdzID0gbGVuKHN5cy5hcmd2KQoKIyBDb21tYW5kIGxpbmUgb3B0aW9ucwoKaWYgKCBhcmdzID09IDMgYW5kIHN5cy5hcmd2WzFdID09ICJhbGVydCIgYW5kICggc3lzLmFyZ3ZbMl0gPT0gIm9uIiBvciBzeXMuYXJndlsyXSA9PSAib2ZmIiApICk6CgkjIFR1cm4gQUxFUlQgTEVEIG9uL29mZgoJaWYgKCB2ZXJzaW9uID09IDEgKToKCQlpZiAoIHN5cy5hcmd2WzJdID09ICJvbiIgKToKCQkJR1BJTy5vdXRwdXQoMjksIDEpCgkJZWxzZToKCQkJR1BJTy5vdXRwdXQoMjksIDApCgllbHNlOgoJCWlmICggc3lzLmFyZ3ZbMl0gPT0gIm9uIiApOgoJCQlhbGVydC5vbigpCgkJZWxzZToKCQkJYWxlcnQub2ZmKCkKZWxpZiAoIGFyZ3MgPT0gMiBhbmQgc3lzLmFyZ3ZbMV0gPT0gIm9uIiApOiAKCSMgVHVybiBvbiBhbGwgcG9ydHMKCWlmICggdmVyc2lvbiA9PSAxICk6CgkJYWxlcnRzdGF0dXMgPSBHUElPLmlucHV0KHBvcnRzWzBdKQoJCWlmIG5vdCBhbGVydHN0YXR1czogR1BJTy5vdXRwdXQocG9ydHNbMF0sIDEpCgkJZm9yIHBvcnQgaW4gcG9ydHNbOi0xXToKCQkJR1BJTy5vdXRwdXQocG9ydCwgMSkKCQkJdGltZS5zbGVlcChkZWxheSkKCQlHUElPLm91dHB1dChwb3J0c1stMV0sIDEpCgkJaWYgbm90IGFsZXJ0c3RhdHVzOiBHUElPLm91dHB1dChwb3J0c1swXSwgMCkKCWVsc2U6CgkJYWxlcnRzdGF0dXMgPSBhbGVydC5nZXQoKQoJCWlmIG5vdCBhbGVydHN0YXR1czogYWxlcnQub24oKQoJCXAxLm9uKCkKCQl0aW1lLnNsZWVwKGRlbGF5KQoJCXAyLm9uKCkKCQl0aW1lLnNsZWVwKGRlbGF5KQoJCXAzLm9uKCkKCQl0aW1lLnNsZWVwKGRlbGF5KQoJCXA0Lm9uKCkKCQlpZiBub3QgYWxlcnRzdGF0dXM6IGFsZXJ0Lm9mZigpCmVsaWYgKCBhcmdzID09IDIgYW5kIHN5cy5hcmd2WzFdID09ICJvZmYiICk6CgkjIFR1cm4gb2ZmIGFsbCBwb3J0cwoJaWYgKCB2ZXJzaW9uID09IDEgKToKCQlhbGVydHN0YXR1cyA9IEdQSU8uaW5wdXQocG9ydHNbMF0pCgkJaWYgbm90IGFsZXJ0c3RhdHVzOiBHUElPLm91dHB1dChwb3J0c1swXSwgMSkKCQlmb3IgcG9ydCBpbiBwb3J0czoKCQkJR1BJTy5vdXRwdXQocG9ydCwgMCkKCQlpZiBub3QgYWxlcnRzdGF0dXM6IEdQSU8ub3V0cHV0KHBvcnRzWzBdLCAwKQoJZWxzZToKCQlhbGVydHN0YXR1cyA9IGFsZXJ0LmdldCgpCgkJaWYgbm90IGFsZXJ0c3RhdHVzOiBhbGVydC5vbigpCgkJcDEub2ZmKCkKCQlwMi5vZmYoKQoJCXAzLm9mZigpCgkJcDQub2ZmKCkKCQlpZiBub3QgYWxlcnRzdGF0dXM6IGFsZXJ0Lm9mZigpCmVsaWYgKCBhcmdzID4gMiBhbmQgKCBzeXMuYXJndlsxXSA9PSAib24iIG9yIHN5cy5hcmd2WzFdID09ICJvZmYiICkgKToKCWlmICggc3lzLmFyZ3ZbMV0gPT0gIm9uIik6CgkJbW9kZSA9IDEKCWVsc2U6CgkJbW9kZSA9IDAKCXplcm9zID0gW10KCSMgUGFyc2UgY29tbWFuZCBsaW5lIG9wdGlvbnMgKDIgY2hhcnMsIHN0YXJ0IHdpdGggcCBhbmQgZW5kIHdpdGggbnVtZXJpYyAxIHRvIDQpCglmb3IgemVybyBpbiBzeXMuYXJndlsyOl06CgkJaWYgKCBsZW4oemVybykgIT0gMiBvciB6ZXJvWzBdICE9ICJwIiBvciAoIGludCh6ZXJvWzFdKSA8IDEgb3IgaW50KHplcm9bMV0pID4gNCApICk6CgkJCXByaW50ICggIkVSUk9SOiBWYWxpZCBvcHRpb25zIGFyZSBwMS9wMi9wMy9wNCIgKQoJCQlzeXMuZXhpdCgpCgkJemVyb3MuYXBwZW5kKCBpbnQoemVyb1sxXSkgKQoJaWYgKCB2ZXJzaW9uID09IDEgKToKCQlhbGVydHN0YXR1cyA9IEdQSU8uaW5wdXQocG9ydHNbMF0pCgkJaWYgbm90IGFsZXJ0c3RhdHVzOiBHUElPLm91dHB1dChwb3J0c1swXSwgMSkKCQlmb3IgemVybyBpbiB6ZXJvc1s6LTFdOgoJCQlHUElPLm91dHB1dChwb3J0c1t6ZXJvXSwgbW9kZSkKCQkJaWYgKCBzeXMuYXJndlsxXSA9PSAib24iICk6IHRpbWUuc2xlZXAoZGVsYXkpCgkJR1BJTy5vdXRwdXQocG9ydHNbemVyb3NbLTFdXSwgbW9kZSkKCQlpZiBub3QgYWxlcnRzdGF0dXM6IEdQSU8ub3V0cHV0KHBvcnRzWzBdLCAwKQoJZWxzZToKCQlhbGVydHN0YXR1cyA9IGFsZXJ0LmdldCgpCgkJaWYgbm90IGFsZXJ0c3RhdHVzOiBhbGVydC5vbigpCgoJCWZvciB6ZXJvIGluIHplcm9zWzotMV06CgkJCWJpdCA9ICgxPDwoemVyby0xKSkKCQkJaWYgKG1vZGUgPT0gMSk6CgkJCQloYXQud3JpdGVfYnl0ZShoYXQucmVhZF9ieXRlKCkgfCBiaXQpCgkJCWVsc2U6CgkJCQloYXQud3JpdGVfYnl0ZShoYXQucmVhZF9ieXRlKCkgJiAofmJpdCB8IDB4RjApKQoJCQl0aW1lLnNsZWVwKGRlbGF5KQoKCQliaXQgPSAoMTw8KHplcm9zWy0xXS0xKSkKCQlpZiAobW9kZSA9PSAxKToKCQkJaGF0LndyaXRlX2J5dGUoaGF0LnJlYWRfYnl0ZSgpIHwgYml0KQoJCWVsc2U6CgkJCWhhdC53cml0ZV9ieXRlKGhhdC5yZWFkX2J5dGUoKSAmICh+Yml0IHwgMHhGMCkpCgoJCWlmIG5vdCBhbGVydHN0YXR1czogYWxlcnQub2ZmKCkKZWxpZiAoIGFyZ3MgPT0gMyBhbmQgc3lzLmFyZ3ZbMV0gPT0gJ2h1YicgYW5kIChzeXMuYXJndlsyXSA9PSAnb24nIG9yIHN5cy5hcmd2WzJdID09ICdvZmYnKSApOgoJaWYgKCB2ZXJzaW9uID09IDEgKToKCQlwcmludCAoICJFUlJPUjogaHViIGNvbnRyb2wgbm90IHN1cHBvcnRlZCBvbiBDbHVzdGVyIEhBVCB2MS54XG4iKQoJZWxzZToKCQlpZiAoIHN5cy5hcmd2WzJdID09ICdvbicgKToKCQkJaWYgKCB2ZXJzaW9uX21pbm9yID09IDAgKToKCQkJCWh1Yi5vbigpCgkJCWVsc2U6CgkJCQlodWIub2ZmKCkKCQllbHNlOgoJCQlpZiAoIHZlcnNpb25fbWlub3IgPT0gMCApOgoJCQkJaHViLm9mZigpCgkJCWVsc2U6CgkJCQlodWIub24oKQplbGlmICggYXJncyA9PSAzIGFuZCBzeXMuYXJndlsxXSA9PSAnd3AnIGFuZCAoc3lzLmFyZ3ZbMl0gPT0gJ29uJyBvciBzeXMuYXJndlsyXSA9PSAnb2ZmJykgKToKCWlmICggdmVyc2lvbiA9PSAxICk6CgkJcHJpbnQgKCAiRVJST1I6IHdyaXRlIHByb3RlY3Qgbm90IHN1cHBvcnRlZCBvbiBDbHVzdGVyIEhBVCB2MS54XG4iKQoJZWxzZToKCQlpZiAoIHN5cy5hcmd2WzJdID09ICdvbicgKToKCQkJd3Aub24oKQoJCWVsc2U6CgkJCWlmICggd3BfbGluayApOgoJCQkJcHJpbnQoIlVuYWJsZSB0byBkaXNhYmxlIEVFUFJPTSBXUCAoU29sZGVyIGxpbmsgc2V0KSIpCgkJCWVsc2U6CgkJCQl3cC5vZmYoKQplbGlmICggYXJncyA9PSAzIGFuZCBzeXMuYXJndlsxXSA9PSAnbGVkJyBhbmQgKHN5cy5hcmd2WzJdID09ICdvbicgb3Igc3lzLmFyZ3ZbMl0gPT0gJ29mZicpICk6CglpZiAoIHZlcnNpb24gPT0gMSApOgoJCXByaW50ICggIkVSUk9SOiBMRUQgY29udHJvbCBub3Qgc3VwcG9ydGVkIG9uIENsdXN0ZXIgSEFUIHYxLnhcbiIpCgllbHNlOgoJCWlmICggc3lzLmFyZ3ZbMl0gPT0gJ29uJyApOgoJCQlsZWQub24oKQoJCWVsc2U6CgkJCWxlZC5vZmYoKQplbGlmICggYXJncyA9PSAyIGFuZCBzeXMuYXJndlsxXSA9PSAnc3RhdHVzJyApOgoJcHJpbnQgKCAidG9vbDp7fSIgKS5mb3JtYXQoIGNsdXN0ZXJoYXRfdmVyc2lvbiApCglwcmludCAoICJ2ZXJzaW9uOnt9Lnt9IiApLmZvcm1hdCAoIHZlcnNpb24sIHZlcnNpb25fbWlub3IgKQoJcHJpbnQgKCAidmVyc2lvbl9tYWpvcjp7fSIgKS5mb3JtYXQoIHZlcnNpb24gKQoJcHJpbnQgKCAidmVyc2lvbl9taW5vcjp7fSIgKS5mb3JtYXQoIHZlcnNpb25fbWlub3IgKQoJZiA9IG9wZW4oaGF0X3V1aWQsICdyJykKCXByaW50ICggInV1aWQ6e30iICkuZm9ybWF0KCBmLnJlYWQoKS5zdHJpcCgnXHgwMCcpICkKCWYuY2xvc2UoKQoJZiA9IG9wZW4oaGF0X3ZlbmRvciwgJ3InKQoJcHJpbnQgKCAidmVuZG9yOnt9IiApLmZvcm1hdCggZi5yZWFkKCkuc3RyaXAoJ1x4MDAnKSApCglmLmNsb3NlKCkKCWYgPSBvcGVuKGhhdF9waWQsICdyJykKCXByaW50ICggInByb2R1Y3RfaWQ6e30iICkuZm9ybWF0KCBmLnJlYWQoKS5zdHJpcCgnXHgwMCcpICkKCWYuY2xvc2UoKQoKCWlmICggdmVyc2lvbiA9PSAxICk6CgkJcHJpbnQgKCAiYWxlcnQ6e30iICkuZm9ybWF0KEdQSU8uaW5wdXQocG9ydHNbMF0pKQoJCWZvciBwIGluIHJhbmdlKDEsIDUpOgoJCQlwcmludCAoICJwe306e30iICkuZm9ybWF0KCBwLCBHUElPLmlucHV0KHBvcnRzW3BdKSApCgoJZWxzZToKCQlwcmludCAoICJhbGVydDp7fSIgKS5mb3JtYXQoIGFsZXJ0LmdldCgpICkKCQlpZiAoIHZlcnNpb25fbWlub3IgPT0gMCApOgoJCQlwcmludCAoICJodWI6ezpkfSIgKS5mb3JtYXQoIGh1Yi5nZXQoKSApCgkJZWxzZToKCQkJcHJpbnQgKCAiaHViOns6ZH0iICkuZm9ybWF0KCBub3QgaHViLmdldCgpICkKCQlwcmludCAoICJ3cDp7fSIgKS5mb3JtYXQoIHdwLmdldCgpICkKCQlwcmludCAoICJsZWQ6e30iICkuZm9ybWF0KCBsZWQuZ2V0KCkgKQoJCXByaW50ICggIndwbGluazp7fSIpLmZvcm1hdCggd3BfbGluayApCgkJcHJpbnQgKCAieHJhMTIwMHA6e30iICkuZm9ybWF0KCB4cmExMjAwcCApCgkJcHJpbnQgKCAidGhyb3R0bGVkOnt9IiApLmZvcm1hdCggZ2V0X3Rocm90dGxlZCgpICkKCQlzdGF0dXMgPSBoYXQucmVhZF9ieXRlKCkKCQlmb3IgcCBpbiByYW5nZSgxLDUpOgoJCQlwcmludCAoICJwe306ezpkfSIgKS5mb3JtYXQoIHAsICgoIHN0YXR1cyAmICgxPDwocC0xKSkgKT4wKSApCmVsaWYgKCBhcmdzID09IDIgYW5kIHN5cy5hcmd2WzFdID09ICdpbml0JyApOgoJIyBGaXJzdCBydW4gaW5pdCBpcyBoYW5kbGVkIGFib3ZlIHRoaXMgaXMganVzdCBoZXJlIHRvIGFsbG93IHRoZSBjb21tYW5kIHRvIHN1Y2NlZWQKCXBhc3MKZWxzZToKCXByaW50KCAiRVJST1I6IFVua25vd24gY29tbWFuZCIgKQo=
    encoding: b64
    path: /sbin/clusterhat
    permissions: '0755'
    owner: root:root

  - content: YWxsb3ctaG90cGx1ZyBldGhwaTEKaWZhY2UgZXRocGkxIGluZXQgbWFudWFsCiAgICAgICAgcHJlLXVwIGlmdXAgYnIwCnByZS11cCBicmN0bCBhZGRpZiBicjAgZXRocGkxCiAgICAgICAgdXAgaWZjb25maWcgZXRocGkxIHVwCgphbGxvdy1ob3RwbHVnIGV0aHBpMgppZmFjZSBldGhwaTIgaW5ldCBtYW51YWwKICAgICAgICBwcmUtdXAgaWZ1cCBicjAKcHJlLXVwIGJyY3RsIGFkZGlmIGJyMCBldGhwaTIKICAgICAgICB1cCBpZmNvbmZpZyBldGhwaTIgdXAKCmFsbG93LWhvdHBsdWcgZXRocGkzCmlmYWNlIGV0aHBpMyBpbmV0IG1hbnVhbAogICAgICAgIHByZS11cCBpZnVwIGJyMApwcmUtdXAgYnJjdGwgYWRkaWYgYnIwIGV0aHBpMwogICAgICAgIHVwIGlmY29uZmlnIGV0aHBpMyB1cAoKYWxsb3ctaG90cGx1ZyBldGhwaTQKaWZhY2UgZXRocGk0IGluZXQgbWFudWFsCiAgICAgICAgcHJlLXVwIGlmdXAgYnIwCnByZS11cCBicmN0bCBhZGRpZiBicjAgZXRocGk0CiAgICAgICAgdXAgaWZjb25maWcgZXRocGk0IHVwCg==
    encoding: b64
    path: /etc/network/interfaces.d/clusterhat

  - content: |
      #!/bin/bash
      # Cluster HAT
      # copymac <sourceif> <destif>
      # Copies MAC address from sourceid to destif
      SMAC=$(/bin/cat /sys/class/net/$1/address)
      /sbin/ip link set $2 address $SMAC
    path: /sbin/copyMAC
    permissions: '0755'
    owner: root:root

  - content: |
      # interfaces(5) file used by ifup(8) and ifdown(8)
      # Include files from /etc/network/interfaces.d:
      source-directory /etc/network/interfaces.d
      auto br0
      iface br0 inet manual
        bridge_ports eth0
        bridge_stp off
        bridge_waitport 0
        bridge_fd 0
        post-up /sbin/copyMAC eth0 br0
    path: /etc/network/interfaces.controller
    
  - content: |
      ##  Fallback ip configuration
      denyinterfaces eth0 ethpi1 ethpi2 ethpi3 ethpi4
      profile clusterhat_fallback_br0
      static ip_address=172.19.181.254/24
      interface br0
      fallback clusterhat_fallback_br0
    path: /etc/dhcpcd.conf.controller

  ## Connection over serial - minicom pX
  - content: |
      pu port             /dev/ttypi1
    path: /etc/minicom/minirc.p1

  - content: |
      pu port             /dev/ttypi2
    path: /etc/minicom/minirc.p2

  - content: |
      pu port             /dev/ttypi3
    path: /etc/minicom/minirc.p3

  - content: |
      pu port             /dev/ttypi4
    path: /etc/minicom/minirc.p4